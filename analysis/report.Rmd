---
title: "Report"
author: "Brendi Ang"
date: "01/11/2021"
output: 
  bookdown::html_document2:
    theme: flatly
    citation_package: biblatex
    toc: true
    number_sections: false
    toc_float:
      collapsed: yes 
bibliography: references.bib
biblio-style: apa
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

```{r}
library(tidyverse)
library(broom)
library(broom.mixed)
library(colorspace)
library(kableExtra)
library(lme4)
library(naniar)
library(patchwork)

ggplot2::theme_set(theme_bw())

select <- dplyr::select
```

```{r}
# Read-in data
mathsci_all <- read_csv(here::here("data/mathsci_all.csv"),
                        # Changing variable type avoids errors
                        col_types = cols(doe_centre_code = col_factor()))

# Convert data types
mathsci_all <- mathsci_all %>% 
  mutate(across(.cols = c(qcaa_subject_id, 
                          subject_type,
                          qcaa_school_id,
                          sector,
                          school_postcode
                          ),
                ~ as.factor(.x))) 
```

# Objectives

This report critically analyses the trends in enrolments for senior secondary (Year 11 and Year 12) mathematics and science subjects in Queensland. Initially, the dataset will be described, from how the dataset is obtained to how the raw data was restructured, cleaned and augmented to facilitate the analysis. This includes imputing missing values, using regular expressions to manipulate character strings and relational joins to combine datasets with matching observations. Next, exploratory data analysis will be conducted using modern data exploration tools to uncover the underlying structures and interesting features of enrolment in all subjects; This will consist of graphical displays such as time plots to better understand the dataset. 

The aforementioned measures taken above gives readers an intuition of the dataset, the report will subsequently focus on building a statistical model to predict enrolments for senior secondary mathematics and science subjects. As the dataset is longitudinal, that is, involving a collection of data (enrolments) from the same school across multiple time points, a multilevel model is deemed appropriate for this analysis. This section of the report will further elaborate the methodology in producing the most appropriate model and the predictions from the 'best' model.

The following research questions guided the report:

(1) What are the underlying trends in senior secondary mathematics and science subjects? 
(2) Are there differences in enrolments in the new QCE system (after 2020) as compared to the old QCE system (before 2020)?


# Data and Motivation

## Extracting the dataset

```{r data-description}
tibble(
  Variable =
    c(
      # Enrolment details
      "completion_year",
      "year_11_enrolments",
      "year_12_enrolments",
      # Subject details
      "qcaa_subject_id",
      "subject_name",
      "subject",
      "subject_type",
      # School details
      "qcaa_school_id",
      "school_name",
      "doe_centre_code",
      "qcaa_district",
      "school_postcode",
      "sector"
    ),
  Description =
    c(
      # Enrolment details
      "Graduation cohort's year of completion",
      "Number of Year 11 students enrolled in the subject",
      "Number of Year 12 students enrolled in the subject",
      # Subject details
      "QCAA subject ID",
      "Subject name",
      "Mathematics or Science subject",
      "Type of subject (General, applied or short courses)",
      # School detail
      "QCAA school ID",
      "School Name",
      "Department of Education Centre Code",
      "School district",
      "School postcode",
      "School sector (Government, Independent, Catholic)"
    )) %>% 
  kable(caption = "Description of the dataset used for the analysis") %>% 
  kable_styling(full_width = FALSE,
                bootstrap_options = c("hovered", "striped")) %>% 
  pack_rows(index = c("Enrolment information" = 3,
                    "Subject information" = 4,
                    "School information" = 6)) 
```

The dataset used for this analysis encompasses enrolment information for all participating schools in the QCE system, and can be extracted in the Queensland Curriculum and Assessment Authority (QCAA) website, where the old enrolments data for the old QCE system (enrolments spanning from 1992 to 2019) can be found under the ["Statistics before 2020" toggle](https://www.qcaa.qld.edu.au/news-data/statistics/statistics-before-2020) (@school-participation) while the enrolments data for the new QCE system can be found under the ["Statistics from 2020" toggle](https://www.qcaa.qld.edu.au/news-data/statistics/statistics-from-2020). 

Each row (observation) corresponds to a school's enrolment information for a subject in a given year, in addition to the school and subject details. The dataset can be broken down into the three main components, as seen above (Table \@ref(tab:data-description)). The data above has been cleaned and is ready for the format that allows for analysis, the further sections will describe the data wrangling process in details.

## The new QCE system

Senior schooling is a pivotal moment for Queensland students as most students transition into tertiary education. The new QCE system was introduced from Year 11 students in 2019, where Overall Position (OP) scores will be replaced by the new Australian Tertiary Admission Rank (ATAR) system in assisting universities in selecting applications in their courses. For this reason, the Queensland Core Skills (QCS) test for year 12 students, which has been in place since 1992 is abolished (after Year 12 in 2019) for the new ATAR system. The ATAR is a inter subject percentile-rank (as opposed to a mark), where students are ranked relative to their age group; To be specific, ATAR is expressed on a 2,000 point scale from 99.95 down to 0.00 in steps of 0.05. 

Queensland ATARs are based on a student's:

  - Best five general subject results, or
  - Best results in four General subjects, plus one Applied subject, or
  - Best results in four General subjects, plus one VET qualification at Certificate III or above

In the ATAR calculation, only *one* applied subject can be included in the ATAR calculation. For instance, if a student enrols in Essential Mathematics (applied subject) and Science in Practice	(Applied subject), only the higher of both 

## A new suite of senior mathematics and science subjects

In light of the new system, a new suite of senior subjects are reviews and redeveloped, along with new ones introduced. The new senior syllabuses include **general (extension) subjects** for students who wish to pursue tertiary pathways, vocational education and training, and work. These subjects will have four summative assessment --- three internal and one external examination at the end of Year 12, which are set and marked by independent teacher assessors accredited the Queensland Curriculum and Assessment Authority. On the other hand, **applied (essential) subjects** are mainly for students interested in pathways beyond school that primarily lead to vocational education and training or directly to work. These subjects tend to be more 'real world' focus and do not have external examinations but have a total of four summative internal assessments.

Notably, this report will not cover **short courses**, which are suited for students who wants to establish a basis for further education or work, typically leading to further vocational education and training.

### Mathematics

```{r qce-math}
# --- Mathematics
mathsci_all %>% 
  filter(subject == "Mathematics") %>% 
  # All unique mathematics subjects
  distinct(subject_name, subject_type) %>% 
  # Include Mathematics for old QCE system
  mutate(
    old_subject_name = case_when(
      subject_name == "General Mathematics" ~ "Mathematics A",
      subject_name == "Mathematical Methods" ~ "Mathematics B",
      subject_name == "Specialist Mathematics" ~ "Mathematics C",
      TRUE ~ paste0("---")
    ),
    .before = subject_name
  ) %>% 
  group_by(subject_type) %>% 
  # Arrange subject names in alphabetical order
  arrange(subject_name) %>% 
  ungroup() %>% 
  select(-subject_type) %>% 
  # Produce HTML table
  kable(caption = "Senior Mathematics subjects in the new QCE system",
        col.names = c("Old subject name","New subject name"),
        booktabs = TRUE,
        align = "c") %>% 
  kable_styling(full_width = FALSE) %>% 
  # Partition subject type
  pack_rows(index = c("Applied Mathematics" = 1,
                      "General Mathematics" = 3)) 
```

There are three main mathematics subjects in the new QCE system, which are broadly equivalent to the Mathematics A, B and C in the old QCE system (Table \@ref(tab:qce-math)). Of the general mathematics subjects, General Mathematics is the least taxing, followed by Mathematical Methods and Specialist Mathematics. Furthermore, Essential Mathematics (applied subject) is introduced in the new system, where is focuses on developing and using mathematical knowledge to investigate real-world problems such as managing money, travel and data, and decision-making using mathematical concept (@essential-math-syllabus). Each school may offer various mathematics programs --- *e.g.* offer two of the three general mathematics subjects, or only offer Essential Mathematics (applied subjects).

Mathematical Methods is often a prerequisite for some university courses, implying that students completing the subject can streamline entry to specific courses in the university. Specialist Mathematics is designed to be taken in conjunction, or on completion of Mathematical methods, as it extends the key ideas studied in that subject. This path is usually recommended for students who wish to undertake further study in mathematics --- such as engineering or science related courses or have strong aptitude in mathematics. 

As an alternative, there is a *safety net* as students may opt for a less challenging mathematics subject such as Essential Mathematics subject (applied subject), as it would also contribute to the student's ATAR score. This subject is usually undertaken by students who do not require mathematics for tertiary education at university of have not been able to attain a pass in Year 10 Core Mathematics. However, it should be noted that only general mathematics subjects or applied mathematics subjects can included in the ATAR, but not both. For instance, it is not possible to incorporate Mathematical Methods (general subject) and Essential Mathematics (applied subject) in a student's ATAR.

### Sciences 

```{r qce-science}
# --- Sciences
mathsci_all %>% 
  filter(subject == "Sciences") %>% 
  # All unique Science subjects
  distinct(subject_name, subject_type) %>% 
  # Include Sciences for old QCE system
  mutate(
    old_subject_name = case_when(
      subject_name == "Psychology" ~ "---",
      subject_name == "Earth & Environmental Science" ~ "Earth Science",
      TRUE ~ subject_name
    ),
    .before = subject_name
  ) %>% 
  group_by(subject_type) %>%
  # Arrange subject names in alphabetical order
  arrange(subject_name, .by_group = TRUE) %>% 
  ungroup() %>% 
  select(-subject_type) %>% 
  # Produce HTML table
  kable(caption = "Senior Science subjects in the new QCE system",
        col.names = c("Old subject name","New subject name"),
        booktabs = TRUE,
        align = "c") %>% 
  kable_styling(full_width = FALSE) %>% 
  # Partition subject type
  pack_rows(index = c("Applied Sciences" = 3,
                      "General Sciences" = 7)) 
```

Unlike mathematics subjects, there are little changes in the subject names. As demonstrated in Table \@ref(tab:qce-science) There are two main changes in science subjects --- 'Psychology' is introduced in the new QCE system and earth science is renamed to Earth and Environmental Science.


# Data Cleaning

To get the dataset ready for the analysis, the dataset is transformed to reproduce that of the new QCE system.

## Joining dataset from old QCE system and new QCE system

**Changing all subject names to match new QCE system**: To combine the datasets relating to the old and new QCE system, the subject names were first matched. As demonstrated in Tables \@ref(tab:qce-math) and \@ref(tab:qce-science), some subjects names were changed in the new QCE system. All subject names in the old system were changed to that of the new system to facilitate the relational join. For example, Mathematics A, B and C were modified to General Mathematics, Mathematical Methods and Specialist Mathematics respectively to match that of the new QCE system. 

**Changing unit 1 and 2, and unit 3 and 4 enrolments to year 11 and year 12 enrolments**: Next, the new QCE system introduce an assessment program consisting of Units 1 and 2. In general, most students complete Units 1 and 2 in Year 11, and Units 3 and 4 are undertaken in year 12. Accordingly, units 1 and 2, and units 3 and 4 are renamed to year 11 enrolments and year 12 enrolments to facilitate the relational join of both datasets corresponding to the old and new QCE system. Once the school and subject information were aligned, both datasets were joined seamlessly.

## Manipulating character strings to match school names

```{r regexps-example}
tibble(
  `School Name (Old QCE system)` = c("St Catherine's Catholic College The Whitsundays (Proserpine (Renwick Road))",
            "Lutheran Ormeau Rivers District School (Lords)",
            "Faith Baptist Christian School (Gladstone)",
            "Rivermount College - Yatala",
            "Carinity Education - Southside"),
  `School Name (New QCE system)` = c("St Catherine's Catholic College The Whitsundays (Proserpine)",
            "Lutheran Ormeau Rivers District School (Pimpama)",
            "Faith Baptist Christian School (Burua)",
            "Rivermount College (Yatala)",
            "Carinity Education - Southside Sunnybank"),
  `Modified School Name` = c("St Catherine's Catholic College The Whitsundays",
                 "Lutheran Ormeau Rivers District School",
                 "Faith Baptist Christian School",
                 "Rivermount College",
                 "Carinity Education")) %>% 
  kable(caption = "Example: Incompatible School names fixed by removing parantheses \"()\" and dash \"-\" ") %>% 
  kable_styling(full_width = FALSE) %>% 
  # Partition subject type
  pack_rows(index = c("Fixed by removing parantheses" = 3,
                      "Fixed by removing dashes" = 2))
```

Regular expressions were utilised to remove school names that did not match in the datasets for the old and new QCE system. An extract of what has been done is shown above (Table \@ref(tab:regexps-example)). Fortunately, schools are uniquely identified with QCAA school ID, easing this process as incompatible school names can be easily identified. In most cases, removing parentheses "()" and dashes "-" relating to suburb solves the issues. 

```{r school-names-error}
tibble(
  `School Name (Old QCE system)` = c("Clairvaux Mackillop College",
                                     "St Aidan's Anglican Girls' School",
                                     "Cloncurry State School P-12",
                                     "Aboriginal & Islander Independent Community School"),
  `School Name (New QCE system)` = c("Clairvaux MacKillop College",
                                     "St Aidan's Anglican Girls School",
                                     "Cloncurry State School",
                                     "Aboriginal and Islander Independent Community School"),
  `Issue (Why school names does not match)` = c("Capital K in 'MacKillop'",
                                                "Extra ' in 'Girls'",
                                                "Extra 'P-12'",
                                                "'&' used instead of 'and'")) %>% 
  kable(caption = "Example: Manually fixing errors due to issues in School Nmaes") %>% 
  kable_styling(full_width = FALSE) 
```

However, there were cases in which school names have to be recoded manually as the school names were inconsistent. Some of the examples are demonstrated in Table \@ref(tab:school-names-error).


## Missing values in enrolments relate to schools offering subject for Year 11 or Year 12 only

```{r missing-data, fig.cap = "At-a-glance plot of the missing values in the raw dataset, where the pink cells indicate a missing value. Most observations are present, except for three variables. The missing values in year 11 and 12 enrolments relates to schools which offered a subject for year 11 but not for year 12 and vice versa"}
mathsci_all %>% 
  # Convert zeroes back to NA (replicate the raw data)
  mutate(year_11_enrolments = na_if(year_11_enrolments, 0), 
         year_12_enrolments = na_if(year_12_enrolments, 0)) %>% 
  # Display missing values
  naniar::vis_miss(warn_large_data = FALSE,
                   sort_miss = TRUE,
                   ) +
  scale_fill_manual(labels = c("Present (99.2%)", "Missing (0.8%)"),
                    values = c("grey80", "black")) +
  theme(panel.grid = element_blank())
```

```{r eval=FALSE}
# All 0 enrolments in year 11
no_enrolments_year_11 <- mathsci_all %>% 
  filter(year_11_enrolments == 0) %>% 
  nrow()

# Contributed by first prep year cohort
prep_year_2007 <- mathsci_all %>% 
  filter(year_11_enrolments == 0 & completion_year == 2019) %>% 
  nrow()

(prep_year_2007 / no_enrolments_year_11) * 100 
```

```{r, eval=FALSE}
# Extracting all schools with 0 enrolments in year 12
year_12_no_enrolments <- mathsci_all %>% 
  filter(year_12_enrolments == 0) %>% 
  nrow()

# Extract zero year 12 enrolments due to the inception of a new subject for a given school
first_year_no_year_12 <- mathsci_all %>% 
  group_by(qcaa_school_id, subject_name) %>% 
  filter(completion_year == min(completion_year)) %>% 
  filter(year_12_enrolments == 0) %>% 
  nrow()
  
(first_year_no_year_12 / year_12_no_enrolments) * 100
```

Figure \@ref(fig:missing-data) illustrates that most of the observations were present, except for there variables relating to enrolments (`year_11_enrolments` and `year_12_enrolments`) and the Department of Education Centre Code (`doe_centre_code`). 

**Zero enrolments in Year 11 and Year 12**

First, 67.13% of the missing values in year 11 enrolments relate to the 2019 graduating cohort that were part of the Queensland's first Prep Year cohort in 2007. Next, 71.48% of the zero enrolments in year 12 corresponds to the first year in which a given school introduces a subject. As year 12 enrolments requires students to complete year 11 syllabus, most students may not partake in the subject when the schools first introduce the subject. In further scrutiny, the other schools that have zero enrolments are usually smaller schools (in rural areas) or schools may only offer a subject for year 11 students but not year 12 students in certain years and vice versa. For example, Mossman State High School offered Specialist Mathematics subject in some years --- Offered the subject to Year 11 students of 2020 and Year 12 students of 2021, but not for Year 11 students of 2021 and Year 12 students of 2022 (@mossman-high). 

**Missing Department of Education Centre Code**

Schools that were missing the Department of Education Centre Code refers to schools that existed before 2002. This alludes that these schools may not have been assigned any Department of Education Centre Code. Fortunately, the dataset provides `qcaa_school_id` which have no missing values and can uniquely identify each school, and thus, thee missing values in `doe_centre_code` may be disregarded.

## Revise school postcodes

Errors in school postcodes usually arise form school postcodes codes being reassigned overtime, due to typographical errors, mainly for schools with two or more different locations. These issues were fixed manually by cross checking the correct addresses for the school provided by Google Maps. 


# Exploratory Data Analaysis

## Total Enrolments for each Subject over the years

```{r}
# Compute total enrolments for each year, by subject
total_enrolments <- mathsci_all %>% 
  group_by(completion_year, subject_name) %>% 
  summarise(total_year12_enrolments = sum(year_12_enrolments),
            .groups = "drop") 

total_enrolments %>% 
  ggplot() +
  # Enrolments for all years (old & new system)
  geom_col(aes(x = completion_year,
               y = total_year12_enrolments),
           fill = "grey80") +
  # Enrolments for from 2019 (new system)
  geom_col(aes(x = completion_year,
               y = total_year12_enrolments),
           fill = "grey30",
           data = filter(total_enrolments, completion_year > 2019)) + 
  facet_wrap(~ subject_name,
             scales = "free_y") +
  scale_x_continuous(breaks = seq(1992, 2022, by = 2),
                     labels = seq(1992, 2022, by = 2)) +
  theme(panel.grid.minor = element_blank())
```


## Time plot: Enrolments across the years

```{r}
# Convert to long format for plotting
mathsci_all_long <- mathsci_all %>% 
  pivot_longer(cols = c(year_11_enrolments, year_12_enrolments),
               names_to = "unit",
               values_to = "enrolments")
```

```{r time-plot-all}
mathsci_all_long %>% 
  # filter(subject_name == "Earth & Environmental Science") %>% 
  group_by(qcaa_school_id, subject_name, unit) %>%
  # Fill missing years with NA to skip when plotting line plot
  tidyr::complete(completion_year = min(completion_year):max(completion_year),
           fill = list(value = NA)) %>% 
  filter(unit == "year_12_enrolments") %>% 
  ggplot() +
  geom_line(aes(x = completion_year,
                y = enrolments,
                group = qcaa_school_id),
            colour = "grey40",
            alpha = 0.4) +
  scale_x_continuous(breaks = seq(1992, 2022, by = 2),
                     labels = seq(1992, 2022, by = 2)) +
  facet_wrap(~ subject_name,
             scales = "free_y") +
  theme(axis.text.x = element_text(angle = 90))
```

Figure \@ref(fig:time-plot-all) displays the year 12 enrolments in for each subject. Each line represents year 12 enrolments for a single school. For most subjects, some relatively large schools can be identified as their enrolments numbers were significantly higher than most other schools. The year 12 enrolments for these large schools were especially prominent in the later years, where the new QCE system was introduced.

Some Subjects that were introduced in the 1990s such as Biology, Chemistry, Physics, General Mathematics and Mathematical Methods showed rather stable enrolment numbers as enrolment trend across schools appears to be proportional to one another. In other words, when there is a general increase (decrease) in enrolments, most schools will show an increase (decrease), as seen by the large cluster of observations. In contrary, Agricultural Earth and Environmental Science, although introduced in the 1990s, did not exhibit such patterns as the enrolment numbers were rather erratic. However, it can be observed that there were significantly less enrolments for these subjects, implying that not many schools offer this subject or the subject is not popular among students.

Subjects were introduced at different time frames. Aquatic practices and Marine Science were only introduced in 2015 and 2014 respectively. There was a halt in Agricultural Practices subject in year 2000, before being re-introduced again in 2015. Furthermore, the inception of the new QCE system was two new subjects, Psychology and Essential Mathematics.


## Linear relationship between year 11 and year 12 enrolments

```{r year11-vs-year12, fig.cap = "Year 12 enrolments agianst year 11 enrolments, with a 45째 line to indicating a perfect linear relationship"}
mathsci_all %>%
  ggplot() + 
  # Scatter plot
  geom_point(aes(x = year_11_enrolments,
                 y = year_12_enrolments,
                 colour = subject),
             alpha = 0.3,
             colour = "grey30") +
  # Plot 45째 line 
  geom_abline(slope = 1,
              intercept = 0,
              size = 1,
              colour = "red",
              alpha = 0.5) +
  facet_wrap(subject_name ~ subject,
             scales = "free") +
  labs(title = "Year 12 enrolments against year 11 enrolments,",
       x = "Year 11 enrolments",
       y = "Year 12 enrolments")
```

A scatterplot of year 11 and year 12 are plotted in Figure \@ref(fig:year11-vs-year12), with a 45째 line to facilitate the interpretation of the scatter plot, where it indicates a one unit increase in year 11 enrolments is matched with a one-unit increase in year 12 enrolments (*i.e.*perfect linear relationship). As already mentioned, the 0 enrolments in year 11 (as seen on the figure) is attributed to the Queensland's first Prep Year cohort in 2007 while the 0 enrolments in year 12 relates to the year where a school introduces the subject for the very first time (thus, there will be no year 12 students as most students have yet to complete year 11). 

Most subject demonstrates a linear relationship (lie on or **close to the red line**) between year 11 and year 12 students. Intuitively, this is reasonable as a student is likely to continue to complete the year 12 syllabus (unit 3 and 4) after completing his year 11 syllabus (unit 1 and 2). 

Observations **below the red line** may suggest that students have dropped the subject or have taken a gap year. Students are usually recommended to enrol in 6 subjects for senior school (**reference**). A student usually starts with 6 subjects in year 11, before dropping down to 5 subjects in Year 12. However, completing 6 subjects gives the student a "safety net", in the instance where the student did not perform well for a particular subject (noting that ATAR takes the best of 5 subjects). Taking this into account, students appears to be dropping Psychology subject, as Figure \@ref(fig:year11-vs-year12) demonstrates that most year 12 enrolments were below the red 45째 line. 

In contrary, observations that lie **above the red line** may indicate that these students may have completed the year 11 (unit 1 and 2) in year 10, and re-enrolled in year 12. Furthermore, students may opt to study at a school of distance education to complete their year 11 (unit 1 and 2) syllabus because of various reasons such as the school not offering year 11 syllabus for a given year.

Some science subjects such as Earth and Environmental Science, Marine science, and Science in Practice displays **heteroscedasticity**, where the larger the cohort size, the higher the rate of students dropping the subject or having more enrolments in year 12. Interestingly, these science subjects have a relatively small number of enrolments. This pattern does not seem to manifest in mathematics subjects.


## Larger schools are associated with lower enrolments in year 12

```{r}
# --- Create data frame showing increase or decrease in year 12 enrolments 

up_or_down <- mathsci_all %>% 
  # Create new variable examining if year 11 enrolments is more than year 12 enrolments
  mutate(slope = if_else(
    year_11_enrolments < year_12_enrolments,
    true = "Upward",
    false = "Downward"),
    slope = as.factor(slope)) %>% 
  # Convert to long format for plotting
  pivot_longer(cols = c(year_11_enrolments, year_12_enrolments),
               names_to = "unit",
               values_to = "enrolments") 

# Remove outliers
up_or_down <- mathsci_all_long %>% 
  group_by(qcaa_school_id) %>% 
  # Zero year 12 students due to introduction of subject
  filter(completion_year != min(completion_year)) %>% 
  ungroup() %>% 
  # Zero year 11 students due to first prep year cohort
  filter(completion_year != 2019) %>% 
  mutate(schoolid_year = paste0(qcaa_school_id, ":", completion_year)) %>% 
  mutate(subject_and_type = paste0(subject, " (", subject_type, ")"))
```

```{r up-or-down, fig.cap = "Parallel Coordinate plot comparing year 11 and year 12 enrolments for a given cohort in a school. The blue (grey) lines represents an increase (decrease) in year 12 enrolments. In general, larger schools appears to have smaller year 12 enrolments, as indicated by numerous grey lines when enrolment numbers are higher"}
ggplot(data = up_or_down,
       aes(x = unit,
           y = enrolments,
           group = schoolid_year)) +
  geom_line(data = filter(up_or_down, slope == "Downward"),
            colour = "grey50",
            alpha = 0.5) +
  geom_line(data = filter(up_or_down, slope == "Upward"),
            colour = "#72bdd4",
            alpha = 0.6) +
  facet_wrap(subject_name ~ subject_and_type,
             scales = "free_y") +
  labs(title = "Parallel coordinates plot highligting the difference betewen year 11 and year 12 enrolments",
       x = "Unit",
       y = "Enrolments")
```

The parallel coordinates plot (Figure \@ref(fig:up-or-down)) allows comparison of the difference between year 11 and year 12 enrolments. The grey line indicates that year 12 enrolments is smaller than year 11 enrolments for a given cohort in a school and conversely, the blue lines represents an increase in enrolments from year 11 to year 12.

In general, larger schools (with relatively high enrolment numbers for a given subject) appears to have smaller year 12 enrolments as compared to year 11 enrolments. This pattern is especially noticeable in Psychology, where most schools with enrolments higher than 150 see a decrease in enrolment numbers from year 11 to year 12. This was not the case for some subjects such as General Mathematics and Chemistry and Biology.

## Distribution of enrolments for each sector

```{r boxplot-dist}
# Distribution of enrolments for each subject by sector
mathsci_all %>%
  ggplot() +
  geom_boxplot(aes(x = sector,
                   y = year_12_enrolments,
                   group = sector),
               outlier.alpha = 0.6) +
  facet_wrap(~ subject_name,
             scales = "free")
```

In most subjects, the distribution in enrolments across all sectors were rather similar (Figure \@ref(fig:boxplot-dist). Subjects that were introduced early such as Biology, Chemistry, Specialist Mathematics, Physics showed stable enrolment numbers, with little variation across the different sectors. As highlighted by the outliers in all subjects, there were schools that has significantly more enrolments, these observations may refer to the larger schools in Queensland. These outliers are considerably prominent, especially in Government schools.


# Acknowledgement

The programming language used to analyse trends in enrolments for senior secondary (Year 11 and Year 12) mathematics and science subjects in Queensland is R (4.0.2) [@R],
and the platform used for running R language is RStudio (1.4.1717) [@RStudio].

The following packages have been included in our Rmd file.

-   package tidyverse (1.3.0) [@tidyverse],
-   package broom (0.7.9) [@broom]
-   package broom.mixed (0.2.7) [@broom-mixed]
-   package colorspace [@colorspace]
-   pacakge kableExtra (1.3.4) [@kableExtra]
-   package lme4 (0.6.7) [@lme4]
-   package patchwork (1.1.1) [@patchwork]
-   package naniar (0.6.0) [@naniar]

# References





